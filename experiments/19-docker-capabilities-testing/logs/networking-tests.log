# Docker Networking Test Results
# Shows which network modes work and which fail

# =============================================================================
# TEST 1: Bridge Networking (Default) - FAILS
# =============================================================================

$ docker run --rm rancher/k3s:v1.33.5-k3s1 echo "test"
docker: Error response from daemon: failed to set up container networking: 
  failed to add interface veth55abc16 to sandbox: 
  failed to subscribe to link updates: permission denied

Run 'docker run --help' for more information

# Root cause: gVisor sandbox restricts network namespace manipulation
# Cannot create veth pairs and attach to bridge

# =============================================================================
# TEST 2: Host Networking - SUCCESS
# =============================================================================

$ docker run --rm --network host --entrypoint /bin/sh \
  rancher/k3s:v1.33.5-k3s1 -c "echo 'Works!' && uname -a"
Works!
Linux runsc 4.4.0 #1 SMP Sun Jan 10 15:06:54 PST 2016 x86_64 GNU/Linux

$ docker run -d --name test --network host --entrypoint /bin/sh \
  rancher/k3s:v1.33.5-k3s1 -c "sleep 30"
f2959b7a07509d025b0cb6901a1c921aa490e767003a4ce0995a5a5058dbd489

$ docker exec test ps aux
PID   USER     COMMAND
    1 root     sleep 30
    7 root     ps aux

$ docker stop test
test

# =============================================================================
# TEST 3: None Networking - SUCCESS
# =============================================================================

$ docker run --rm --network none --entrypoint /bin/sh \
  rancher/k3s:v1.33.5-k3s1 -c "echo 'No network works too'"
No network works too

# =============================================================================
# TEST 4: Custom Network Creation - PARTIAL
# =============================================================================

$ docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
b2a3885a3716   bridge    bridge    local
be2c58c097d7   host      host      local
6c8b259e0c62   none      null      local

$ docker network create test-net
256e5ec98f8cd65913d67d18225b12e0d7057683f2eff5217d8b0e393f89ee3a
# Network creation succeeds

$ docker run -d --name net-test1 --network test-net --entrypoint /bin/sh \
  rancher/k3s:v1.33.5-k3s1 -c "sleep 60"
c6cab47f2fecc2cb5d51115637bc3f65918d8c43150476608eb2081450099260
docker: Error response from daemon: failed to set up container networking: 
  failed to add interface vetha2df8bf to sandbox: 
  failed to subscribe to link updates: permission denied
# Attaching container to custom network fails (same error as bridge)

$ docker network rm test-net
test-net

# =============================================================================
# CONCLUSION
# =============================================================================

✅ Host networking (--network host) - Works perfectly
✅ None networking (--network none) - Works perfectly
❌ Bridge networking (default) - Permission denied
❌ Custom networks - Can create but can't use
❌ Port mapping (-p flag) - Not available (requires bridge)

WORKAROUND: Use --network host for all containers
  - All containers share host network namespace
  - Services communicate via localhost:<port>
  - Each service must use a unique port
