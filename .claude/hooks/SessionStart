#!/bin/bash

# SessionStart hook for Claude Code
# This script runs automatically when a new Claude Code session starts

# Only run in remote (web) environments
if [ "$CLAUDE_CODE_REMOTE" != "true" ]; then
    echo "Running locally, skipping environment setup"
    exit 0
fi

echo "======================================"
echo "Claude Code on the Web Environment"
echo "Kubernetes Research Project"
echo "======================================"
echo ""

# Run the setup script to ensure all tools are installed
if [ -f "tools/setup-claude.sh" ]; then
    echo "Installing development tools..."
    bash tools/setup-claude.sh
    echo ""
fi

# Configure environment variables for kubectl
if [ -f "/etc/rancher/k3s/k3s.yaml" ]; then
    export KUBECONFIG="/etc/rancher/k3s/k3s.yaml"
    echo "âœ“ KUBECONFIG configured"
fi

# Add CNI bin directory to PATH
export PATH="/opt/cni/bin:$PATH"

echo "======================================"
echo "Production-Ready Solution Available"
echo "======================================"
echo ""
echo "ðŸŽ‰ Experiment 05: Control-Plane (PRODUCTION-READY)"
echo ""
echo "Start the k3s control-plane:"
echo "  sudo bash solutions/control-plane-native/start-k3s-native.sh"
echo ""
echo "Perfect for:"
echo "  âœ“ Helm chart development"
echo "  âœ“ YAML validation"
echo "  âœ“ API compatibility testing"
echo "  âœ“ RBAC policy development"
echo "  âœ“ kubectl operations"
echo ""
echo "Quick start commands:"
echo "  kubectl get namespaces --insecure-skip-tls-verify"
echo "  helm create mychart"
echo "  helm install test ./mychart/"
echo ""
echo "Research Documentation:"
echo "  - PROGRESS-SUMMARY.md - Complete findings"
echo "  - experiments/17-inotify-cgroup-faker/README.md - Latest experiment"
echo "  - experiments/15-stable-wait-monitoring/README.md - Stable k3s"
echo ""
echo "Note: Pod execution is not possible in this environment"
echo "      (requires real kernel cgroup subsystem)"
echo ""

